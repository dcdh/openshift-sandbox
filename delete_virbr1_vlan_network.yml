---
- name: Delete virbr1 vlan network
  vars:
    bridge_name: "virbr1"
  block:
    - name: Delete {{ bridge_name }} interface
      file:
        path: /etc/sysconfig/network-scripts/ifcfg-{{ bridge_name }}
        state: absent
    - name: restart service network
      systemd:
        state: restarted
        name: network
    - name: Disable dnsmasq service
      shell: systemctl disable dnsmasq@{{ bridge_name }}.service
    - name: Delete {{ bridge_name }} Host configuration
      file:
        path: /var/lib/dnsmasq/{{ bridge_name }}
        state: absent
    - name: Flush iptable entries
      block:
        - name: Remove forward all input in interface {{ bridge_name }}
          shell: iptables -D FORWARD --in-interface {{ bridge_name }} -j ACCEPT
          ignore_errors: yes
        - name: Remove forward all output in interface {{ bridge_name }}
          shell: iptables -D FORWARD --out-interface {{ bridge_name }} -j ACCEPT
          ignore_errors: yes
        - name: Save iptable rules
          shell: "service iptables save"
  become: true
  become_user: root